FROM gcr.io/spark-operator/spark-py:v3.1.1

LABEL maintainer="Antrea <projectantrea-dev@googlegroups.com>"
LABEL description="A docker image to deploy ThroughputAnomaly Detection Spark job."

WORKDIR /opt/spark/work-dir
USER root

RUN apt-get --allow-releaseinfo-change update && \
    apt-get install -y --no-install-recommends wget ca-certificates && \
    wget https://github.com/ClickHouse/clickhouse-jdbc/releases/download/v0.3.1/clickhouse-jdbc-0.3.1.jar -P /opt/spark/jars/

RUN pip3 install --upgrade pip && \
    pip3 install pyyaml && \
    pip3 install kubernetes

COPY plugins/throughputanomaly-detection/ThroughputAnomalyDetection.py /opt/spark/work-dir/ThroughputAnomalyDetection.py
COPY plugins/throughputanomaly-detection/SparkStreaming.py /opt/spark/work-dir/SparkStreaming.py